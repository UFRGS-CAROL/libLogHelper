#!/bin/bash

NUMBER_OF_PROCESSORS=@NUMBER_OF_PROCESSORS@

# Edit the following command to be compatible with your device
# The following command works only on NVIDIA GPUs
ECC_RETURN=$(/usr/bin/nvidia-smi --query-gpu=gpu_name,ecc.mode.current --format=csv,noheader 2>/tmp/trash)
SUB='Enabled'
if [[ "$ECC_RETURN" == *"$SUB"* ]]; then
  echo "1" > @ECC_INFO_FILE_DIR@
else
  echo "0" > @ECC_INFO_FILE_DIR@
fi

# set mce check interval to short
for i in $(seq 0 ${NUMBER_OF_PROCESSORS})
do
	echo 10 > /sys/devices/system/machinecheck/machinecheck"$i"/check_interval;
	echo 3 > /sys/devices/system/machinecheck/machinecheck"$i"/tolerant
done

# turn off crash on uncorrectable errs
echo 0 > /sys/module/edac_core/parameters/edac_mc_panic_on_ue

##ONLY FOR TEST PURPOSE
#sudo ntpdate -dv @SERVER_IP@ > @HOME_DIR@/log_ntpdate.log 2>@HOME_DIR@/log_ntpdate.log
#sudo ntpdate NTPServer1 >>  @HOME_DIR@/log_ntpdate.log 2>>@HOME_DIR@/log_ntpdate.log

# NTP date update for a specific server
ntpdate -u @SERVER_IP@ > @HOME_DIR@/log_ntpdate.log 2>> @HOME_DIR@/log_ntpdate.log

# Perform any other operation that is necessary to your test at the boot step
exit 0
